openapi: 3.0.3
info:
  title: Windows Desktop Cloud Browser Model API
  description: |
    Local API for browser profile management and automation.
    
    **IMPORTANT:** This is NOT a MoreLogin Local API compatibility layer. 
    This is a standalone browser automation API with its own endpoint structure.
    While it provides similar functionality to MoreLogin, the endpoint paths 
    and naming conventions are independent.
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:3000/api
    description: Local development server
  - url: http://127.0.0.1:3000/api
    description: Local loopback

tags:
  - name: Profile
    description: Profile management operations
  - name: Group
    description: Group management operations
  - name: Tag
    description: Tag management operations
  - name: Proxy
    description: Proxy management operations
  - name: Environment
    description: System and environment operations

paths:
  /profile/create:
    post:
      tags:
        - Profile
      summary: Create a new profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                groupId:
                  type: string
                  format: uuid
                tags:
                  type: array
                  items:
                    type: string
                    format: uuid
                proxyId:
                  type: string
                  format: uuid
                browserType:
                  type: string
                  enum: [firefox, chromium]
                  default: firefox
                userAgent:
                  type: string
                timezone:
                  type: string
                locale:
                  type: string
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'

  /profile/list:
    get:
      tags:
        - Profile
      summary: List all profiles
      parameters:
        - name: groupId
          in: query
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Profile'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /profile/detail/{id}:
    get:
      tags:
        - Profile
      summary: Get profile details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Profile details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /profile/update/{id}:
    put:
      tags:
        - Profile
      summary: Update profile
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                groupId:
                  type: string
                  format: uuid
                tags:
                  type: array
                  items:
                    type: string
                    format: uuid
                proxyId:
                  type: string
                  format: uuid
                browserType:
                  type: string
                  enum: [firefox, chromium]
                userAgent:
                  type: string
                timezone:
                  type: string
                locale:
                  type: string
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'

  /profile/delete/{id}:
    delete:
      tags:
        - Profile
      summary: Delete profile
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Profile deleted successfully
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /profile/start/{id}:
    post:
      tags:
        - Profile
      summary: Start profile browser session
      description: |
        Launches browser session for the specified profile.
        Updates lastUsedAt timestamp to current time.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Session started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  sessionId:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [active]
                  lastUsedAt:
                    type: string
                    format: date-time
                    example: "2026-02-19T03:07:01.991Z"

  /profile/stop/{id}:
    post:
      tags:
        - Profile
      summary: Stop profile browser session
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Session stopped successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [stopped]

  /profile/status/{id}:
    get:
      tags:
        - Profile
      summary: Get profile session status
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Session status
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [active, stopped, idle]
                  sessionId:
                    type: string
                    format: uuid
                    nullable: true

  /profile/duplicate/{id}:
    post:
      tags:
        - Profile
      summary: Duplicate profile
      description: Clone profile with new ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Name for duplicated profile (optional)
      responses:
        '201':
          description: Profile duplicated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'

  /profile/export/{id}:
    post:
      tags:
        - Profile
      summary: Export profile data
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Profile data exported
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/Profile'
                  cookies:
                    type: array
                    items:
                      type: object
                  localStorage:
                    type: object

  /profile/import:
    post:
      tags:
        - Profile
      summary: Import profile data
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - profile
              properties:
                profile:
                  type: object
                cookies:
                  type: array
                  items:
                    type: object
                localStorage:
                  type: object
      responses:
        '201':
          description: Profile imported successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'

  /group/create:
    post:
      tags:
        - Group
      summary: Create a new group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                description:
                  type: string
                color:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
      responses:
        '201':
          description: Group created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'

  /group/list:
    get:
      tags:
        - Group
      summary: List all groups
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Group'

  /group/detail/{id}:
    get:
      tags:
        - Group
      summary: Get group details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /group/update/{id}:
    put:
      tags:
        - Group
      summary: Update group
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                color:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
      responses:
        '200':
          description: Group updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'

  /group/delete/{id}:
    delete:
      tags:
        - Group
      summary: Delete group
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Group deleted successfully
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /group/assign:
    post:
      tags:
        - Group
      summary: Assign profiles to group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - groupId
                - profileIds
              properties:
                groupId:
                  type: string
                  format: uuid
                profileIds:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Profiles assigned to group successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  groupId:
                    type: string
                    format: uuid
                  assignedCount:
                    type: integer

  /tag/create:
    post:
      tags:
        - Tag
      summary: Create a new tag
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                color:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
      responses:
        '201':
          description: Tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'

  /tag/list:
    get:
      tags:
        - Tag
      summary: List all tags
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tag'

  /tag/update/{id}:
    put:
      tags:
        - Tag
      summary: Update tag
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                color:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
      responses:
        '200':
          description: Tag updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'

  /tag/delete/{id}:
    delete:
      tags:
        - Tag
      summary: Delete tag
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Tag deleted successfully
        '404':
          description: Tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /tag/assign:
    post:
      tags:
        - Tag
      summary: Assign tags to profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - profileId
                - tagIds
              properties:
                profileId:
                  type: string
                  format: uuid
                tagIds:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Tags assigned to profile successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  profileId:
                    type: string
                    format: uuid
                  assignedCount:
                    type: integer

  /proxy/create:
    post:
      tags:
        - Proxy
      summary: Create a new proxy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - host
                - port
              properties:
                name:
                  type: string
                type:
                  type: string
                  enum: [http, https, socks5]
                host:
                  type: string
                port:
                  type: integer
                  minimum: 1
                  maximum: 65535
                username:
                  type: string
                password:
                  type: string
      responses:
        '201':
          description: Proxy created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Proxy'

  /proxy/list:
    get:
      tags:
        - Proxy
      summary: List all proxies
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Proxy'

  /proxy/update/{id}:
    put:
      tags:
        - Proxy
      summary: Update proxy
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                type:
                  type: string
                  enum: [http, https, socks5]
                host:
                  type: string
                port:
                  type: integer
                  minimum: 1
                  maximum: 65535
                username:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Proxy updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Proxy'

  /proxy/delete/{id}:
    delete:
      tags:
        - Proxy
      summary: Delete proxy
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Proxy deleted successfully
        '404':
          description: Proxy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /proxy/test/{id}:
    post:
      tags:
        - Proxy
      summary: Test proxy connection
      description: Local proxy validation
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Proxy test successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [working, failed]
                  latency:
                    type: integer
                    description: Latency in milliseconds
                  ip:
                    type: string
                    description: Public IP address through proxy

  /env/info:
    get:
      tags:
        - Environment
      summary: Get system information
      responses:
        '200':
          description: System information
          content:
            application/json:
              schema:
                type: object
                properties:
                  platform:
                    type: string
                    example: linux
                  arch:
                    type: string
                    example: x64
                  nodeVersion:
                    type: string
                    example: v18.0.0
                  memory:
                    type: object
                    properties:
                      total:
                        type: integer
                      free:
                        type: integer

  /env/version:
    get:
      tags:
        - Environment
      summary: Get API version info
      responses:
        '200':
          description: API version information
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    example: 1.0.0
                  apiVersion:
                    type: string
                    example: v1
                  build:
                    type: string

  /env/cache/cleanCloud:
    get:
      tags:
        - Environment
      summary: Clean cloud cache (Not Implemented)
      description: |
        Cloud-only feature not available in self-hosted version.
        See scope-exceptions.md for details.
      responses:
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Profile:
      type: object
      required:
        - id
        - name
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique profile identifier
        name:
          type: string
          description: Profile name
        groupId:
          type: string
          format: uuid
          nullable: true
          description: Group association
        tags:
          type: array
          items:
            type: string
            format: uuid
          description: Associated tag IDs
        proxyId:
          type: string
          format: uuid
          nullable: true
          description: Proxy configuration
        browserType:
          type: string
          enum: [firefox, chromium]
          default: firefox
        userAgent:
          type: string
          description: Custom user agent string
        timezone:
          type: string
          description: IANA timezone identifier
          example: America/New_York
        locale:
          type: string
          description: Locale code
          example: en-US
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp (ISO 8601 UTC)
          example: "2026-02-19T03:07:01.991Z"
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp (ISO 8601 UTC)
          example: "2026-02-19T03:07:01.991Z"
        lastUsedAt:
          type: string
          format: date-time
          nullable: true
          description: |
            Last session start timestamp (ISO 8601 UTC).
            Updated only when profile session starts.
            See 14-parity-matrix.md Section 4 for details.
          example: "2026-02-19T03:07:01.991Z"

    Group:
      type: object
      required:
        - id
        - name
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          description: Group name
        description:
          type: string
          nullable: true
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          description: Hex color code
          example: "#FF5733"
        profileCount:
          type: integer
          minimum: 0
          description: |
            Computed field: number of profiles in this group.
            Calculated via: SELECT COUNT(*) FROM profiles WHERE groupId = ?
            See 14-parity-matrix.md Section 3 for details.
        createdAt:
          type: string
          format: date-time
          example: "2026-02-19T03:07:01.991Z"
        updatedAt:
          type: string
          format: date-time
          example: "2026-02-19T03:07:01.991Z"

    Tag:
      type: object
      required:
        - id
        - name
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          example: "#FF0000"
        profileCount:
          type: integer
          minimum: 0
          description: |
            Computed field: number of profiles with this tag.
            Calculated via: SELECT COUNT(*) FROM profile_tags WHERE tagId = ?
        createdAt:
          type: string
          format: date-time
          example: "2026-02-19T03:07:01.991Z"
        updatedAt:
          type: string
          format: date-time
          example: "2026-02-19T03:07:01.991Z"

    Proxy:
      type: object
      required:
        - id
        - name
        - type
        - host
        - port
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [http, https, socks5]
        host:
          type: string
        port:
          type: integer
          minimum: 1
          maximum: 65535
        username:
          type: string
          nullable: true
        password:
          type: string
          nullable: true
          writeOnly: true
        profileCount:
          type: integer
          minimum: 0
          description: |
            Computed field: number of profiles using this proxy.
            Calculated via: SELECT COUNT(*) FROM profiles WHERE proxyId = ?
        createdAt:
          type: string
          format: date-time
          example: "2026-02-19T03:07:01.991Z"
        updatedAt:
          type: string
          format: date-time
          example: "2026-02-19T03:07:01.991Z"

    Pagination:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
        limit:
          type: integer
          minimum: 1
          maximum: 100
        total:
          type: integer
          minimum: 0

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error type
        message:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
        details:
          type: object
          description: Additional error details

